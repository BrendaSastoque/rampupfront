pipeline{
	agent any
	stages{
		stage('Build'){
			steps{
				script{
				frontimage = docker.build("brendasastoque/frontimg")
				}
				echo "Built"
			}     
		}
		stage ('Push image'){
			steps {
				script {
					docker.withRegistry('https://registry.hub.docker.com','docker-hub-credentials'){
						frontimage.push("${env.BUILD_NUMBER}")
						frontimage.push("latest")
					}
				}
			}
		}
		stage ('Test'){
			steps {
				echo "Tested"
			}
		}
		stage ('Deploy'){
			steps {
				sshagent(credentials : ['key-ssh']){
					sh 'ssh -o StrictHostKeyChecking=no ec2-user@ip-10-0-1-197 uptime'
					sh 'ssh -v ec2-user@ip-10-0-1-107 -p 22'
					sh 'docker run -p 3030:3030 -d registry.hub.docker.com/brendasastoque/frontimg'
				}
				echo "Deployed"
				
			}
		}
		
	}
}
